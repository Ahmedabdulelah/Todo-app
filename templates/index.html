<html>
    <head>
        <title>Todo App</title>
    </head>
    <body>
        <style>
            .hidden{
                display:none;
            }
            ul{
                list-style: none;
                padding: 0;
                margin: 0;
                width: 200px;
            }
            li{
                clear: both;
            }
            li button{
                /* -webkit-appearance: none; */
                border: none;
                outline: none;
                color: red;
                font-size: 20px;
                cursor: pointer;
                float: right;
            }
        </style>
        <form id="form">
            <input type="text" id="description" name="description">
            <input type="submit" value="create">
        </form>
        <!-- <div class = "hidden" id = "error"> Something went wrong! </div> -->
        <ul id="todos">
            {% for d in data %}
            <li><input class="check-completed" data-id="{{d.id}}" type="checkbox"{% if d.completed %} checked {% endif %}>
                {{d.description}}
                <!-- <button class="delete-button" data-id="{{todo.id}}">&cross;</button> -->
            </li>
            {% endfor %}
        </ul>
        
        <script>
                const deletebtn = document.querySelectorAll(".delete-button")
                //for deleting todos from the list and database using AJAX request
                for(let i = 0; i<deletebtn.length; i++){
                    const btn = deletebtn[i]
                    btn.onclick = function(e){
                        const todoId = e.terget.dataset['id']
                        fetch('/todos/' + todoId,{
                            method : 'DELETE'
                        });
                    }
                }

                const checkboxes = document.querySelectorAll('.check-completed')
                for (let i = 0; i<checkboxes.length; i++){
                    const checkbox = checkboxes[i];
                    checkbox.onchange = function(e){
                        const newcompleted = e.terget.checked;
                        const todoId = e.terget.dataset['id'];
                        fetch('/todos/'+ todoId +'set-completed', {
                            method : 'POST',
                            body : JSON.stringify({
                                'completed' :newcompleted
                            }),
                            headers:{
                                'Content-Type' : 'application/json'
                            }

                        })
                    }
                }
                document.getElementById("form").onsubmit= function(event){
                    event.preventDefault();
                    fetch('/todoapp/create',{
                    method : 'POST',
                    body : JSON.stringify({
                        'description': document.getElementById("description").value
                    }),
                    headers:{
                        'content-type':'application/json'
                    }
                })
                .then(function(response){
                    return response.json();
                })
                .then(function(jsonResponse){
                    console.log(jsonResponse);
                    const letitem = document.createElement('LI');
                    letitem.innerHTML = jsonResponse['description'];
                    // document.getElementById("error").className = '.hidden';
                    document.getElementById("todos").appendChild(letitem);
                })
                .catch(function(){
                    document.getElementById("error").className = '';
                })
            }               
        </script>
        </body>



</html>